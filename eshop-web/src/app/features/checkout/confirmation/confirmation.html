<div class="confirmation-container">
  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  } @else if (paymentFailed()) {
    <mat-card class="error-card">
      <mat-icon class="error-icon">cancel</mat-icon>
      <h2>Paiement échoué</h2>
      <p>{{ error() }}</p>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="continueShopping()">
          <mat-icon>shopping_cart</mat-icon>
          Continuer mes achats
        </button>
      </div>
    </mat-card>
  } @else if (error()) {
    <mat-card class="error-card">
      <mat-icon class="error-icon">error</mat-icon>
      <h2>Erreur</h2>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="continueShopping()">
        Continue Shopping
      </button>
    </mat-card>
  } @else if (order()) {
    <div class="success-header">
      <div class="success-icon-container">
        <mat-icon class="success-icon">check_circle</mat-icon>
      </div>
      <h1>Commande confirmée !</h1>
      <p class="success-message">
        Merci pour votre commande. Un email de confirmation vous a été envoyé avec les détails.
      </p>
      @if (paymentStatus() === 'Processing') {
        <mat-card class="warning-card">
          <mat-icon>hourglass_empty</mat-icon>
          <p>Votre paiement est en cours de traitement. Vous recevrez une confirmation sous peu.</p>
        </mat-card>
      }
    </div>

    <mat-card class="order-details-card">
      <div class="order-header">
        <div>
          <h2>Order #{{ order()!.id }}</h2>
          <p class="order-date">Placed on {{ order()!.orderDate | date:'medium' }}</p>
        </div>
        <div class="order-status">
          <span class="status-badge" [class]="'status-' + order()!.orderStatus.toLowerCase()">
            {{ order()!.orderStatus }}
          </span>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="order-section">
        <h3>Shipping Information</h3>
        <div class="info-content">
          <mat-icon>local_shipping</mat-icon>
          <div>
            <p><strong>Delivery Address:</strong></p>
            <p>{{ order()!.shippingAddress }}</p>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="order-section">
        <h3>Payment Method</h3>
        <div class="info-content">
          <mat-icon>payment</mat-icon>
          <div>
            <p><strong>{{ order()!.paymentMethod }}</strong></p>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="order-section">
        <h3>Order Items</h3>
        <div class="order-items">
          @for (item of order()!.items; track item.id) {
            <div class="order-item">
              <img [src]="getImageUrl(item.pictureUrl)" [alt]="item.productName">
              <div class="item-details">
                <h4>{{ item.productName }}</h4>
                <p class="item-quantity">Quantity: {{ item.quantity }}</p>
                <p class="item-price">{{ item.unitPrice | number:'1.0-0' }} FCFA each</p>
              </div>
              <div class="item-total">
                {{ (item.unitPrice * item.quantity) | number:'1.0-0' }} FCFA
              </div>
            </div>
          }
        </div>
      </div>

      <mat-divider></mat-divider>

      <div class="order-total">
        <div class="total-row">
          <span>Subtotal:</span>
          <span>{{ orderTotal | number:'1.0-0' }} FCFA</span>
        </div>
        <div class="total-row">
          <span>Shipping:</span>
          <span class="free">FREE</span>
        </div>
        <div class="total-row">
          <span>Tax:</span>
          <span>{{ orderTax | number:'1.0-0' }} FCFA</span>
        </div>
        <div class="total-row grand-total">
          <span>Total:</span>
          <span>{{ order()!.totalAmount | number:'1.0-0' }} FCFA</span>
        </div>
      </div>
    </mat-card>

    <div class="action-buttons">
      <button mat-stroked-button (click)="printOrder()">
        <mat-icon>print</mat-icon>
        Print Order
      </button>
      <button mat-stroked-button color="primary" (click)="viewOrders()">
        <mat-icon>receipt_long</mat-icon>
        View All Orders
      </button>
      <button mat-raised-button color="primary" (click)="continueShopping()">
        <mat-icon>shopping_bag</mat-icon>
        Continue Shopping
      </button>
    </div>

    <mat-card class="info-card">
      <mat-icon>info</mat-icon>
      <div>
        <h3>What's Next?</h3>
        <ul>
          <li>You will receive an email confirmation shortly</li>
          <li>Your order is being processed and will be shipped soon</li>
          <li>Track your order status in the Orders section</li>
          <li>Contact support if you have any questions</li>
        </ul>
      </div>
    </mat-card>
  }
</div>
