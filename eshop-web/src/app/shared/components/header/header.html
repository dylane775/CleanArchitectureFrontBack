<header class="main-header">
  <!-- Main Toolbar (Amazon-style) -->
  <mat-toolbar class="toolbar">
    <div class="toolbar-container">
      <!-- Logo Section -->
      <div class="brand-section">
        <a routerLink="/" class="logo-link">
          <mat-icon class="logo-icon">shopping_bag</mat-icon>
          <span class="brand-name">eShop</span>
        </a>
      </div>

      <!-- Search Bar (Central - Amazon style) with Auto-complete -->
      <div class="search-section">
        <form class="search-wrapper" (submit)="onSearch(); $event.preventDefault()">
          <input
            #searchInput
            type="text"
            class="search-input"
            placeholder="Search for products, brands and more..."
            [value]="searchQuery()"
            (input)="onSearchInput($event)"
            (focus)="onSearchFocus()"
            (keydown)="onKeyDown($event)"
            name="search"
            autocomplete="off"
          />
          @if (isLoadingSuggestions()) {
            <mat-spinner diameter="20" class="search-spinner"></mat-spinner>
          }
          @if (searchQuery() && !isLoadingSuggestions()) {
            <button type="button" class="clear-btn" (click)="clearSearch()">
              <mat-icon>close</mat-icon>
            </button>
          }
          <button type="submit" class="search-btn" mat-flat-button>
            <mat-icon>search</mat-icon>
          </button>
        </form>

        <!-- Suggestions Dropdown -->
        @if (showSuggestions() && suggestions().length > 0) {
          <div class="suggestions-dropdown">
            @for (suggestion of suggestions(); track suggestion.id; let i = $index) {
              <div
                class="suggestion-item"
                [class.selected]="i === selectedSuggestionIndex()"
                (click)="selectSuggestion(suggestion)"
                (mouseenter)="selectedSuggestionIndex.set(i)">
                <img
                  [src]="getSuggestionImageUrl(suggestion)"
                  [alt]="suggestion.name"
                  class="suggestion-image"
                  loading="lazy">
                <div class="suggestion-info">
                  <span class="suggestion-name">{{ suggestion.name }}</span>
                  <span class="suggestion-meta">
                    @if (suggestion.brand) {
                      <span class="suggestion-brand">{{ suggestion.brand }}</span>
                    }
                    @if (suggestion.category) {
                      <span class="suggestion-category">in {{ suggestion.category }}</span>
                    }
                  </span>
                </div>
                <span class="suggestion-price">{{ suggestion.price | currency:'XAF':'symbol':'1.0-0' }}</span>
              </div>
            }
            <div class="suggestion-footer" (click)="onSearch()">
              <mat-icon>search</mat-icon>
              <span>See all results for "{{ searchQuery() }}"</span>
            </div>
          </div>
        }
      </div>

      <!-- User Actions Section -->
      <div class="user-section">
        <!-- Returns & Orders -->
        <button mat-button routerLink="/orders" class="orders-btn">
          <div class="orders-content">
            <span class="orders-greeting">Returns</span>
            <strong class="orders-label">& Orders</strong>
          </div>
        </button>

        <!-- Notifications (only for authenticated users) -->
        @if (isAuthenticated()) {
          <app-notification-bell></app-notification-bell>
        }

        <!-- Wishlist (only for authenticated users) -->
        @if (isAuthenticated()) {
          <button mat-button routerLink="/wishlist" class="wishlist-btn">
            <div class="wishlist-icon-wrapper">
              <mat-icon class="wishlist-icon">favorite</mat-icon>
              @if (wishlistCount() > 0) {
                <span class="wishlist-badge">{{ wishlistCount() }}</span>
              }
            </div>
          </button>
        }

        <!-- Shopping Cart -->
        <button mat-button routerLink="/basket" class="cart-btn">
          <div class="cart-icon-wrapper">
            <mat-icon class="cart-icon">shopping_cart</mat-icon>
            @if (basketItemCount() > 0) {
              <span class="cart-badge">{{ basketItemCount() }}</span>
            }
          </div>
          <span class="cart-label">Cart</span>
        </button>

        <!-- Account Menu (à l'extrême droite) -->
        @if (isAuthenticated()) {
          <button mat-button [matMenuTriggerFor]="userMenu" class="account-btn">
            <div class="account-content">
              <span class="account-greeting">Hello, {{ getUserDisplayName() }}</span>
              <div class="account-label">
                <strong>Account & Lists</strong>
                <mat-icon class="dropdown-icon">arrow_drop_down</mat-icon>
              </div>
            </div>
          </button>
          <mat-menu #userMenu="matMenu" class="user-menu-panel">
            @if (isAdmin()) {
              <button mat-menu-item routerLink="/admin/dashboard">
                <mat-icon>admin_panel_settings</mat-icon>
                <span>Admin Dashboard</span>
              </button>
              <mat-divider></mat-divider>
            }
            <button mat-menu-item (click)="navigateToProfile()">
              <mat-icon>person</mat-icon>
              <span>Your Profile</span>
            </button>
            <button mat-menu-item (click)="navigateToOrders()">
              <mat-icon>receipt_long</mat-icon>
              <span>Your Orders</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="logout()">
              <mat-icon>logout</mat-icon>
              <span>Sign Out</span>
            </button>
          </mat-menu>
        } @else {
          <button mat-button routerLink="/auth/login" class="account-btn">
            <div class="account-content">
              <span class="account-greeting">Hello, Sign in</span>
              <div class="account-label">
                <strong>Account & Lists</strong>
              </div>
            </div>
          </button>
        }
      </div>
    </div>
  </mat-toolbar>

  <!-- Navigation Bar (Categories - Amazon style) -->
  <div class="nav-bar">
    <div class="nav-container">
      <nav class="nav-links">
        <!-- All Categories Menu -->
        <button mat-button [matMenuTriggerFor]="categoriesMenu" class="nav-link categories-link">
          <mat-icon>menu</mat-icon>
          <span>All</span>
        </button>
        <mat-menu #categoriesMenu="matMenu">
          <button mat-menu-item routerLink="/catalog">
            <mat-icon>store</mat-icon>
            <span>All Products</span>
          </button>
          <mat-divider></mat-divider>
          <button mat-menu-item routerLink="/catalog" [queryParams]="{category: 'electronics'}">
            <mat-icon>devices</mat-icon>
            <span>Electronics</span>
          </button>
          <button mat-menu-item routerLink="/catalog" [queryParams]="{category: 'fashion'}">
            <mat-icon>checkroom</mat-icon>
            <span>Fashion</span>
          </button>
          <button mat-menu-item routerLink="/catalog" [queryParams]="{category: 'home'}">
            <mat-icon>home</mat-icon>
            <span>Home & Kitchen</span>
          </button>
        </mat-menu>

        <!-- Quick Links -->
        <a routerLink="/catalog" [queryParams]="{filter: 'new'}" class="nav-link">
          <span>New Arrivals</span>
        </a>
        <a routerLink="/catalog" [queryParams]="{filter: 'bestsellers'}" class="nav-link">
          <span>Best Sellers</span>
        </a>
        <a routerLink="/catalog" [queryParams]="{filter: 'deals'}" class="nav-link deals-link">
          <span>Today's Deals</span>
        </a>
        <a routerLink="/catalog" [queryParams]="{filter: 'gift'}" class="nav-link">
          <span>Gift Ideas</span>
        </a>
        <a routerLink="/orders" routerLinkActive="active" class="nav-link">
          <span>Track Orders</span>
        </a>
      </nav>
    </div>
  </div>
</header>
