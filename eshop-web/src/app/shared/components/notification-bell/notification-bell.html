<div class="notification-bell-container">
  <!-- Bell Icon -->
  <button class="bell-button" (click)="toggleDropdown()" [class.has-unread]="hasUnread()">
    <span class="material-icons">notifications</span>
    @if (hasUnread()) {
      <span class="badge">{{ unreadCount() > 99 ? '99+' : unreadCount() }}</span>
    }
  </button>

  <!-- Dropdown -->
  @if (isOpen()) {
    <div class="notification-dropdown">
      <div class="dropdown-header">
        <h3>Notifications</h3>
        @if (hasUnread()) {
          <button class="mark-all-read" (click)="markAllAsRead()">
            Tout marquer comme lu
          </button>
        }
      </div>

      <div class="notification-list">
        @if (notifications().length === 0) {
          <div class="empty-state">
            <span class="material-icons">notifications_off</span>
            <p>Aucune notification</p>
          </div>
        } @else {
          @for (notification of notifications(); track notification.id) {
            <div
              class="notification-item"
              [class.unread]="!notification.isRead"
              (click)="onNotificationClick(notification)"
            >
              <div class="notification-icon" [style.background-color]="getColor(notification.type)">
                <span class="material-icons">{{ getIcon(notification.type) }}</span>
              </div>
              <div class="notification-content">
                <div class="notification-title">{{ notification.title }}</div>
                <div class="notification-message">{{ notification.message }}</div>
                <div class="notification-time">{{ getTimeAgo(notification.createdAt) }}</div>
              </div>
              <div class="notification-actions">
                @if (!notification.isRead) {
                  <button class="action-btn" (click)="markAsRead(notification, $event)" title="Marquer comme lu">
                    <span class="material-icons">check</span>
                  </button>
                }
                <button class="action-btn delete" (click)="deleteNotification(notification, $event)" title="Supprimer">
                  <span class="material-icons">close</span>
                </button>
              </div>
            </div>
          }
        }
      </div>

      <div class="dropdown-footer">
        <button class="view-all-btn" (click)="viewAllNotifications()">
          Voir toutes les notifications
        </button>
      </div>
    </div>
  }
</div>

<!-- Toast Notification -->
@if (showToast() && toastNotification()) {
  <div class="toast-notification" [class.show]="showToast()">
    <div class="toast-icon" [style.background-color]="getColor(toastNotification()!.type)">
      <span class="material-icons">{{ getIcon(toastNotification()!.type) }}</span>
    </div>
    <div class="toast-content">
      <div class="toast-title">{{ toastNotification()!.title }}</div>
      <div class="toast-message">{{ toastNotification()!.message }}</div>
    </div>
    <button class="toast-close" (click)="dismissToast()">
      <span class="material-icons">close</span>
    </button>
  </div>
}
